# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  batch: true
  branches:
    include:
      - master
  paths:
    include:
      - /deploy/

pool:
  vmImage: 'ubuntu-latest'

resources:
  containers:
  - container: webapp
    type: ACR  
    azureSubscription: onlex-sinnet-prod
    resourceGroup: sinnet-default-manual
    registry: sinnet
    repository: webapp
    trigger: "true"

# steps:
# - script: echo |
#     echo $(resources.container.mycontainer.type)
#     echo $(resources.container.mycontainer.registry)
#     echo $(resources.container.mycontainer.repository)
#     echo $(resources.container.webapp.tag)
#     echo $(resources.container.mycontainer.digest)
#     echo $(resources.container.mycontainer.URI)
#     echo $(resources.container.mycontainer.location)

stages:
  - stage:
    displayName: CD
    jobs:
      - deployment: DeployWeb
        displayName: WebApp
        # creates an environment if it doesn't exist
        environment: 'smarthotel-dev'
        strategy:
          runOnce:
            deploy:
              steps:
              - script: echo Hello world
# steps:
# - task: PublishBuildArtifacts@1
#   displayName: 'publish yaml folder as an artifact'
#   inputs:
#     pathToPublish: $(System.DefaultWorkingDirectory)/deploy/main
#     artifactName: 'yaml'
