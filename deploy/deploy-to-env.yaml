parameters:
- name: envName # name of the environment (DEV01, STG01, PRD01)
  type: string # data type of the parameter; required
  default: false

# variables:
#    envNameLower: ${{ lower(parameters.envName) }}

stages:
  stage: deployToDev01
  displayName: Deploy HELM Chart to DEV01
  jobs:
    - deployment: deployToStg
      displayName: Deploy to DEV01
      environment:
        name: DEV01
        resourceType: Kubernetes
      strategy:                  
        runOnce:
          deploy:
            steps:
              - checkout: none
              - download: helm_CI
                artifact: chart
              - bash: |
                  echo "##vso[task.setvariable variable=var_chart_file_name]$(cat $(Pipeline.Workspace)/helm_CI/chart/chart.config | jq '.chartFileName')"
              - bash: |
                  echo $(Pipeline.Workspace)/helm_CI/chart/$(var_chart_file_name)
              - task: HelmDeploy@0
                displayName: Helm install
                inputs:
                  kubernetesServiceEndpoint: onlex-sinnet-dev01
                  command: upgrade
                  install: true
                  chartName: $(Pipeline.Workspace)/helm_CI/chart/$(var_chart_file_name)
                  arguments: -f $(Pipeline.Workspace)/helm_CI/chart/config.yaml
                  releaseName: sinnet-reports
                  namespace: onlex-sinnet-dev01